<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Struk Pembayaran</title>
    <style>
        body {
            font-family: monospace;
            max-width: 400px;
            margin: auto;
            padding: 20px;
            text-align: center;
        }
        .receipt-container {
            border: 1px solid #000;
            border-radius: 5px;
            padding: 10px;
            margin-top: 20px;
            display: none; /* Awalnya disembunyikan */
        }
        table {
            width: 100%;
            margin: 10px 0;
            border-collapse: collapse;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border: 1px solid #000;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</head>
<body>
    <button id="generate-button">Generate Struk</button>
    <button id="download-button" style="display:none;">Download Struk</button>
    
    <h1>Struk Pembayaran</h1>
    <div class="receipt-container" id="receipt">
        <p id="store-name"></p>
        <p id="store-address"></p>
        <p id="store-phone"></p>
        <p>Nomor Transaksi: <span id="transaction-number"></span></p>
        <p>Tanggal: <span id="transaction-date"></span></p>
        <p>Kasir: <span id="cashier-name"></span></p>
        <table id="items-table">
            <tr>
                <th>Item</th>
                <th>Jumlah</th>
                <th>Harga Satuan</th>
                <th>Total</th>
            </tr>
        </table>
        <p>Metode Pembayaran: Tunai</p>
        <p>Terima kasih telah berbelanja!</p>
    </div>

    <script>
        const items = [
            { name: "Indomie Goreng", price: 2500 },
            { name: "Minyak Goreng", price: 22000 },
            { name: "Susu UHT", price: 10000 },
            { name: "Mie Instan", price: 3000 },
            { name: "Biskuit", price: 15000 },
            { name: "Kopi", price: 10000 },
            { name: "Teh Botol", price: 5000 },
            { name: "Coklat", price: 20000 },
            { name: "Sabun", price: 15000 },
            { name: "Sikat Gigi", price: 10000 }
        ];

        const streets = [
            "Jl. Merdeka No. ", 
            "Jl. Pahlawan No. ", 
            "Jl. Jend. Sudirman No. ", 
            "Jl. Gatot Subroto No. ", 
            "Jl. Soekarno-Hatta No. "
        ];

        const stores = [
            "CV. Toko Maju", 
            "CV. Sumber Berkah", 
            "CV. Usaha Bersama"
        ];

        const cashiers = [
            "Budi", 
            "Ani", 
            "Joko"
        ];

        const getRandomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

        const generateRandomTransactionNumber = () => {
            const date = new Date();
            return date.getFullYear().toString() + 
                   (date.getMonth() + 1).toString().padStart(2, '0') + 
                   date.getDate().toString().padStart(2, '0') + 
                   date.getHours().toString().padStart(2, '0') + 
                   date.getMinutes().toString().padStart(2, '0') + 
                   date.getSeconds().toString().padStart(2, '0');
        };

        const generateRandomData = () => {
            const storeName = stores[getRandomInt(0, stores.length - 1)];
            const storeAddress = streets[getRandomInt(0, streets.length - 1)] + getRandomInt(100, 999);
            const storePhone = "021-" + getRandomInt(100, 999) + "-" + getRandomInt(1000, 9999);
            const cashierName = cashiers[getRandomInt(0, cashiers.length - 1)];

            document.getElementById('store-name').innerText = storeName;
            document.getElementById('store-address').innerText = storeAddress;
            document.getElementById('store-phone').innerText = storePhone;
            document.getElementById('cashier-name').innerText = cashierName;

            const transactionNumber = generateRandomTransactionNumber();
            document.getElementById('transaction-number').innerText = transactionNumber;
            document.getElementById('transaction-date').innerText = new Date().toLocaleString();

            const itemCount = getRandomInt(3, 6); // Generate between 3 to 6 items
            const itemsTable = document.getElementById('items-table');

            // Clear previous rows except for header
            while (itemsTable.rows.length > 1) {
                itemsTable.deleteRow(1);
            }

            let subtotal = 0;
            for (let i = 0; i < itemCount; i++) {
                const item = items[getRandomInt(0, items.length - 1)];
                const quantity = getRandomInt(1, 5);
                const total = item.price * quantity;

                subtotal += total;

                const row = itemsTable.insertRow();
                row.insertCell(0).innerText = item.name;
                row.insertCell(1).innerText = quantity;
                row.insertCell(2).innerText = `Rp ${item.price.toLocaleString()}`;
                row.insertCell(3).innerText = `Rp ${total.toLocaleString()}`;
            }

            // Hitung total tunai dan kembalian
            const totalTunai = subtotal + 10000; // Asumsikan pengguna memberikan Rp 10.000 lebih
            const kembalian = totalTunai - subtotal;

            // Tambahkan baris untuk subtotal
            const rowSubtotal = itemsTable.insertRow();
            rowSubtotal.insertCell(0).innerText = ""; // Kosongkan sel pertama
            rowSubtotal.insertCell(1).innerText = ""; // Kosongkan sel kedua
            rowSubtotal.insertCell(2).innerText = "Subtotal";
            rowSubtotal.insertCell(3).innerText = `Rp ${subtotal.toLocaleString()}`;

            // Tambahkan baris untuk tunai
            const cashRow = itemsTable.insertRow();
            cashRow.insertCell(0).innerText = ""; // Kosongkan sel pertama
            cashRow.insertCell(1).innerText = ""; // Kosongkan sel kedua
            cashRow.insertCell(2).innerText = "Tunai";
            cashRow.insertCell(3).innerText = `Rp ${totalTunai.toLocaleString()}`;

            // Tambahkan baris untuk kembalian
            const changeRow = itemsTable.insertRow();
            changeRow.insertCell(0).innerText = ""; // Kosongkan sel pertama
            changeRow.insertCell(1).innerText = ""; // Kosongkan sel kedua
            changeRow.insertCell(2).innerText = "Kembalian";
            changeRow.insertCell(3).innerText = `Rp ${kembalian.toLocaleString()}`;

            // Tampilkan struk dan tombol download
            document.querySelector('.receipt-container').style.display = 'block';
            document.getElementById('download-button').style.display = 'inline';
        };

        document.getElementById('generate-button').onclick = generateRandomData;

        document.getElementById('download-button').onclick = () => {
            const receipt = document.getElementById('receipt');
            const storeName = document.getElementById('store-name').innerText;
            const transactionNumber = document.getElementById('transaction-number').innerText;
            const fileName = `${storeName.replace(/\s+/g, '_')}_${transactionNumber}.png`; // Format: "CV_Toko_Maju_20241023124530.png"
            html2canvas(receipt).then(canvas => {
                canvas.toBlob(function(blob) {
                    saveAs(blob, fileName);
                });
            }).catch(err => console.error(err));
        };
    </script>
</body>
</html>
